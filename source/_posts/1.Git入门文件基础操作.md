---
title: Git.1.入门文件基础操作
date: 2019-02-17 15:01:32
tags: 
  - Git
categories: 
	- 版本控制工具
---

## Git、GitHuB与GitLab
Git 是一个分布式版本控制软件。
GitHub于Git都是用于管理版本的服务端软件，GitHub提供免费服务（代码需要公开）以及付费服务(代码私有)。
GitLab用于在企业内部管理Git版本库，功能上类似GitHub。


## Git文件的三种状态

状态|描述|对应区域
---|---|--- 
modified|已修改|工作区
staged|已暂存|索引区（暂存区）
committed|已提交|文件版本库

modified：在工作目录修改的Git文件。
staged：对已经修改文件执行Git暂存操作，放入暂存区。
committed：对暂存区的文件执行Git提交操作，存入版本库中。


## Git常用操作
### 创建git仓库
首先新建个文件夹mygit作为git仓库的文件目录，在mygit文件夹下 **git init** 命令生成git仓库相关的文件。git仓库文件存放在.git隐藏文件夹下。

``` bash.sh
$ mkdir mygit
$ cd mygit
$ git init
$ ls -al
total 16
drwxr-xr-x 1 CHEN 197609 0 2月  12 14:33 ./
drwxr-xr-x 1 CHEN 197609 0 2月  12 14:31 ../
drwxr-xr-x 1 CHEN 197609 0 2月  12 14:33 .git/
$ cd .git
$ ls -al
total 11
drwxr-xr-x 1 CHEN 197609   0 2月  12 14:33 ./
drwxr-xr-x 1 CHEN 197609   0 2月  12 14:33 ../
-rw-r--r-- 1 CHEN 197609 130 2月  12 14:33 config
-rw-r--r-- 1 CHEN 197609  73 2月  12 14:33 description
-rw-r--r-- 1 CHEN 197609  23 2月  12 14:33 HEAD
drwxr-xr-x 1 CHEN 197609   0 2月  12 14:33 hooks/
drwxr-xr-x 1 CHEN 197609   0 2月  12 14:33 info/
drwxr-xr-x 1 CHEN 197609   0 2月  12 14:33 objects/
drwxr-xr-x 1 CHEN 197609   0 2月  12 14:33 refs/
```

### 文件操作
git status 查看Git工作区状态
git add \<file> 在已修改的文件加入到Git暂存区中
git add . 将所有工作区的文件加入到暂存区
git commit 提交到Git版本库中
git log 日志

```bash.sh
$ pwd
/c/Users/CHEN/mygit

#在Git库中创建test.txt 写入内容查看git文件状态 
$ touch test.txt
$ echo 'hello world' >test.txt
$ git status
On branch master
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

        modified:   test.txt

no changes added to commit (use "git add" and/or "git commit -a")

#将在已修改的文件加入到Git暂存区中
$ git add test.txt
warning: LF will be replaced by CRLF in test.txt.
The file will have its original line endings in your working directory
$ git status
On branch master
Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

        modified:   test.txt

#将暂存区中的文件提交到Git版本库中
$ git commit -m 'initial commit'
[master ea36502] initial commit
 1 file changed, 1 insertion(+), 1 deletion(-)
$ git status
On branch master
nothing to commit, working tree clean

#查看提交日志
git log
commit ea365027e0b230733898fea25c8b65a68fca9bcf (HEAD -> master)
Author: dgqg1223 <2878466@qq.com>
Date:   Tue Feb 12 16:16:22 2019 +0800

    initial commit
```

### 取消修改和从暂存区撤回
git checkout -- \<file> 取消修改
git reset HEAD \<file>; 从暂存区撤回到修改状态
```bash.sh
$ echo 'welcome' > test.txt
$ git status
On branch master
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

        modified:   test.txt

no changes added to commit (use "git add" and/or "git commit -a")
$ cat test.txt
welcome
#取消修改
$ git checkout test.txt
$ cat test.txt
hello world
$ git status
On branch master
nothing to commit, working tree clean

$ echo 'welcome' > test.txt
$ git add test.txt
warning: LF will be replaced by CRLF in test.txt.
The file will have its original line endings in your working directory
$ git status
On branch master
Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

        modified:   test.txt
#从暂存区撤回到修改状态
$ git reset HEAD test.txt
Unstaged changes after reset:
M       test.txt

$ git status
On branch master
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

        modified:   test.txt

no changes added to commit (use "git add" and/or "git commit -a")
```
### 删除已提交的文件与重命名
rm 系统自带删除文件命令，执行后需要自己存入暂存区之后提交
git rm git为我们提供的rm命令，执行后可以直接提交
mv 系统自带移动命令，可以用来重命名，执行后需要自己存入暂存区之后提交
git mv git为我们提供的mv命令，执行后可以直接提交

### git log相关操作
git log -3 显示最近3行提交日志
git log --pretty=oneline 每行提交日志一行显示
``` bash.sh
$ git log -3
commit 6fb99c970e4505b23a651e75869ae2b089841b0c (HEAD -> dev, master)
Author: dgqg1223 <2878466@qq.com>
Date:   Wed Feb 13 16:02:31 2019 +0800

    cereate test and .gitignore

commit ea365027e0b230733898fea25c8b65a68fca9bcf
Author: dgqg1223 <2878466@qq.com>
Date:   Tue Feb 12 16:16:22 2019 +0800

    initial commit

commit 1a85be516532439892205080efceec55ff1af5bb
Author: dgqg1223 <2878466@qq.com>
Date:   Tue Feb 12 15:40:49 2019 +0800

    sdcond commit

CHEN@DESKTOP-ER5E7MT MINGW64 ~/mygit (dev)
$ git log --pretty=oneline
6fb99c970e4505b23a651e75869ae2b089841b0c (HEAD -> dev, master) cereate test and .gitignore
ea365027e0b230733898fea25c8b65a68fca9bcf initial commit
1a85be516532439892205080efceec55ff1af5bb sdcond commit
96d05738f22d4d5714d542843a013cd129c096c9 initial commit

```
### 自定义git log格式
```bash.sh
$ git log --pretty=format:"%h - %an,%ar :%s"
6fb99c9 - dgqg1223,2 hours ago :cereate test and .gitignore
ea36502 - dgqg1223,25 hours ago :initial commit
1a85be5 - dgqg1223,26 hours ago :sdcond commit
96d0573 - dgqg1223,27 hours ago :initial commit
```

选项	|说明
---|---
%H|提交对象（commit）的完整哈希字串
%h|提交对象的简短哈希字串
%T|树对象（tree）的完整哈希字串
%t|树对象的简短哈希字串
%P|父对象（parent）的完整哈希字串
%p|父对象的简短哈希字串
%an|作者（author）的名字
%ae|作者的电子邮件地址
%ad|作者修订日期（可以用 -date= 选项定制格式）
%ar|作者修订日期，按多久以前的方式显示
%cn|提交者(committer)的名字
%ce|提交者的电子邮件地址
%cd|提交日期
%cr|提交日期，按多久以前的方式显示
%s|提交说明

>git config --global alias.lm  "log --no-merges --color --date=format:'%Y-%m-%d %H:%M:%S' --author='你的名字！自己修改！' --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Cblue %s %Cgreen(%cd) %C(bold blue)<%an>%Creset' --abbrev-commit"


>git config --global alias.lms  "log --no-merges --color --stat --date=format:'%Y-%m-%d %H:%M:%S' --author='你的名字！自己修改！' --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Cblue %s %Cgreen(%cd) %C(bold blue)<%an>%Creset' --abbrev-commit"


>git config --global alias.ls "log --no-merges --color --graph --date=format:'%Y-%m-%d %H:%M:%S' --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Cblue %s %Cgreen(%cd) %C(bold blue)<%an>%Creset' --abbrev-commit"


>git config --global alias.lss "log --no-merges --color --stat --graph --date=format:'%Y-%m-%d %H:%M:%S' --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Cblue %s %Cgreen(%cd) %C(bold blue)<%an>%Creset' --abbrev-commit"

### 查看git帮助的三种方式
```bash.sh
$ git help config
$ git config --help
$ man git-config
```

### .gitignore
可以定义在不想被git管理的文件（不存入git库只在本地使用），在git仓库下建立.gitignore文件，vi写入不需要git管理的文件名，之后把.gitignore提交到版本控制器中。
.gitignore支持通配符和正则表达式
git会自动忽略空文件夹
```.gitigoner
#所有名字为a.b的文件都忽略
a.b
#所有.b结尾的文件都忽略
*.b
#c.b不忽略
!c.b
#只忽略根目录下的test.txt
/test.txt
#只忽略根目录下某个文件夹下的test.txt
/*/test.txt
#忽略根目录某个文件夹中或所有子文件夹下的test.txt
/**/test.txt
#忽略doc文件夹下所有.txt文件
doc/*.txt
#忽略doc文件夹下子文件夹下的子文件夹下的所有.txt文件
doc/*/*.txt
#忽略doc文件夹下所有的.txt文件（包括各层子文件夹）
doc/**/*.txt
```

## 关于Git的提交id（commit id）
Git的提交commit id 是一个摘要值，这个摘要值是通过sha1方式计算出来的，由于Git是分布式版本控制系统，所以无法使用递增的版本号。使用版本号也可以取前几位。
``` bash.sh
git log
commit ea365027e0b230733898fea25c8b65a68fca9bcf (HEAD -> master)
Author: dgqg1223 <2878466@qq.com>
Date:   Tue Feb 12 16:16:22 2019 +0800
```


## Git修改本地存储的用户名和邮箱
### Git用户名和邮箱存放的位置（linux为例，windows可以使用git Bash查看）
1. /etc/gitconfig（存放于系统全局配置文件，几乎不使用，作用域为整个操作系统）
2. ~/.gitconfig(存放于系统配置文件，很常用，作用域为用户)
3. 项目库中/.get/config(存放在Git库文件夹中，作用域为当前Git库)

作用优先级:从小到大 库>用户>操作系统。

### 修改相关操作
使用git config 命令可以查看用法
相关参数：
--global              修改全局配置文件
--system              修改系统配置文件
--local               修改本地配置文件
-l, --list            查看所有配置文件信息
--unset               删除指定配置文件信息
```
$ git config
usage: git config [<options>]

Config file location
    --global              use global config file
    --system              use system config file
    --local               use repository config file
    -f, --file <file>     use given config file
    --blob <blob-id>      read config from given blob object

Action
    --get                 get value: name [value-regex]
    --get-all             get all values: key [value-regex]
    --get-regexp          get values for regexp: name-regex [value-regex]
    --get-urlmatch        get value specific for the URL: section[.var] URL
    --replace-all         replace all matching variables: name value [value_regex]
    --add                 add a new variable: name value
    --unset               remove a variable: name [value-regex]
    --unset-all           remove all matches: name [value-regex]
    --rename-section      rename section: old-name new-name
    --remove-section      remove a section: name
    -l, --list            list all
    -e, --edit            open an editor
    --get-color           find the color configured: slot [default]
    --get-colorbool       find the color setting: slot [stdout-is-tty]

Type
    -t, --type <>         value is given this type
    --bool                value is "true" or "false"
    --int                 value is decimal number
    --bool-or-int         value is --bool or --int
    --path                value is a path (file or directory name)
    --expiry-date         value is an expiry date

Other
    -z, --null            terminate values with NUL byte
    --name-only           show variable names only
    --includes            respect include directives on lookup
    --show-origin         show origin of config (file, standard input, blob, command line)
    --default <value>     with --get, use default value when missing entry
```
具体操作
```shell.sh
#查看配置文件
$ cat .git/config
[core]
        repositoryformatversion = 0
        filemode = false
        bare = false
        logallrefupdates = true
        symlinks = false
        ignorecase = true
#添加用户与邮箱
$ git config --local user.name '张三'
$ git config --local user.email 'test@test.com'
#查看配置文件已经添加了用户和邮箱信息
$ cat .git/config
[core]
        repositoryformatversion = 0
        filemode = false
        bare = false
        logallrefupdates = true
        symlinks = false
        ignorecase = true
[user]
        name = 张三
        email = test@test.com
#可以单独查看指定配置
$ git config user.name
张三
$ git config user.email
test@test.com
#可以使用--list参数看到所有配置信息
$ git config --list
... ...
core.logallrefupdates=true
core.symlinks=false
core.ignorecase=true
user.name=张三
user.email=test@test.com
#更改用户名为李四
$ git config user.name '李四'
#查看配置文件已变更为李四
$ cat .git/config
[core]
        repositoryformatversion = 0
        filemode = false
        bare = false
        logallrefupdates = true
        symlinks = false
        ignorecase = true
[user]
        name = 李四
        email = test@test.com
#删除用户名和邮箱信息
$ git config --local --unset user.name
$ git config --local --unset user.email
#查看配置文件已经删除
$ cat .git/config
[core]
        repositoryformatversion = 0
        filemode = false
        bare = false
        logallrefupdates = true
        symlinks = false
        ignorecase = true

```

git commit --anend --reset-author 修改用户名邮箱后重新提交